name: ุชุดุบูู VPS ูุชุญููู ูููุงุช ุงูุตูุช

on:
  push:
    branches:
      - main  # ุฃู ุงููุฑุน ุงูุฐู ุชุณุชุฎุฏููุ ูุซูุงู 'master'

jobs:
  vps:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # ุณูุจูู ูุดุทุงู ููุฏุฉ 6 ุณุงุนุงุช

    steps:
      - name: ุชุซุจูุช ุงูุญุฒู ุงูุฃุณุงุณูุฉ
        run: |
          sudo apt update
          sudo apt install -y curl wget openssh-server

      - name: ุฅุนุฏุงุฏ ูุชุดุบูู SSH
        run: |
          # ุฅูุดุงุก ูุฌูุฏ SSH
          sudo mkdir -p /var/run/sshd

          # ุชุบููุฑ ูููุฉ ูุฑูุฑ root ูุชุณููู ุงูุฏุฎูู
          echo "root:Admin@123" | sudo chpasswd

          # ุงูุณูุงุญ ุจุชุณุฌูู ุงูุฏุฎูู ููููุฉ ุงููุฑูุฑ
          sudo sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
          sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config
          sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config

          # ุฅุนุงุฏุฉ ุชุดุบูู ุฎุฏูุฉ SSH
          sudo service ssh restart
          echo "ุชู ุชุดุบูู SSH ุจูุฌุงุญ."

      - name: ุฅูุดุงุก ูุฌูุฏ ูููููุงุช ุงูุตูุชูุฉ
        run: |
          mkdir -p ~/quran-audio
          echo "ุชู ุฅูุดุงุก ูุฌูุฏ quran-audio ูู ูุณุงุฑ ุงููุณุชุฎุฏู."

      - name: ุชุญููู ูููุงุช ุงูุตูุช (ูู 001 ุฅูู 114)
        run: |
          cd ~/quran-audio
          BASE_URL="https://server12.mp3quran.net/maher/Almusshaf-Al-Mo-lim"
          echo "ุจุฏุก ุชุญููู 114 ููู ุตูุชู..."

          # ุญููุฉ for ูุชุญููู ุงููููุงุช ูู 1 ุฅูู 114
          for i in $(seq -f "%03g" 1 114); do
            FILE_NAME="${i}.mp3"
            URL="${BASE_URL}/${FILE_NAME}"
            
            echo "ุฌุงุฑู ุชุญููู: ${FILE_NAME}"
            
            # ุงุณุชุฎุฏุงู wget ููุชุญูููุ ูุน ุงูุงุณุชูุฑุงุฑ ูู ุญุงู ูุดู ุฑุงุจุท ูุนูู
            wget -q --show-progress "${URL}" -O "${FILE_NAME}"
            
            if [ $? -eq 0 ]; then
              echo "โ ุชู ุชุญููู: ${FILE_NAME}"
            else
              echo "โ ูุดู ุชุญููู: ${FILE_NAME} (ูุฏ ูููู ุงูุฑุงุจุท ุบูุฑ ููุฌูุฏ)"
            fi
          done
          
          echo "ุชู ุงูุงูุชูุงุก ูู ูุญุงููุฉ ุชุญููู ุฌููุน ุงููููุงุช."
          echo "ุงููููุงุช ุงูููุฌูุฏุฉ ุญุงููุงู:"
          ls -la ~/quran-audio/

      - name: ุนุฑุถ ูุนูููุงุช ุงูุฅุชุตุงู (SSH)
        run: |
          echo ""
          echo "==========================================="
          echo "โ ุฌูุงุฒ VPS ุฌุงูุฒ ููุงุณุชุฎุฏุงู! โ"
          echo "==========================================="
          echo ""
          echo "๐น ูุนูููุงุช ุงูุงุชุตุงู ุนุจุฑ SSH:"
          echo "   ุงููุถูู: 127.0.0.1 (ุฃู localhost)"
          echo "   ุงููููุฐ: 22"
          echo "   ุงููุณุชุฎุฏู: root"
          echo "   ูููุฉ ุงููุฑูุฑ: Admin@123"
          echo ""
          echo "๐น ูููุน ุงููููุงุช ุงูุตูุชูุฉ:"
          echo "   ~/quran-audio/  (ุฃู /home/runner/quran-audio/)"
          echo ""
          echo "โ๏ธ  ููุงุญุธุฉ: ูุฐุง ุงูุฌูุงุฒ ูุนูู ุฏุงุฎู GitHub Actions"
          echo "    ููุง ูููู ุงูุงุชุตุงู ุจู ูู ุงูุฅูุชุฑูุช ูุจุงุดุฑุฉ ุฅูุง ุฅุฐุง ููุช ุจุฅุถุงูุฉ"
          echo "    ุฎุฏูุฉ ูุนูุณ ุงูุงุชุตุงู ูุซู ngrok ุฃู serveo.net (ููู ูุง ุทูุจุช ุฅุฒุงูุชู)."
          echo "==========================================="
          echo ""

      - name: ุฅุจูุงุก ุงูุฌูุงุฒ ูุดุทุงู
        run: |
          echo "ุงูุฌูุงุฒ ุณูุจูู ูุดุทุงู ููุฏุฉ 6 ุณุงุนุงุช. ููููู ุฅุถุงูุฉ ุฃูุงูุฑ ุฃุฎุฑู ููุง."
          echo "ููุญุงูุงุฉ ุนูู ุญููููุ ุณูุชู ุชุญุฏูุซ ุงูููุช ูู 5 ุฏูุงุฆู."
          while true; do
            echo "ุงูุฌูุงุฒ ูุง ูุฒุงู ูุดุทุงู: $(date)"
            sleep 300  # ููุงู ููุฏุฉ 5 ุฏูุงุฆู
          done
      - name: Keep VPS alive
        run: |
          while true; do
            sleep 300
          done
